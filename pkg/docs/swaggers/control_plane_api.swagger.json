{
  "swagger": "2.0",
  "info": {
    "title": "control_plane_api.proto",
    "version": "version not set"
  },
  "tags": [
    {
      "name": "ControlPlaneAPI"
    }
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/api/control_plane/services": {
      "get": {
        "operationId": "ControlPlaneAPI_ListServices",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/velez_apiListServicesResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/googlerpcStatus"
            }
          }
        },
        "tags": [
          "ControlPlaneAPI"
        ]
      }
    },
    "/api/control_plane/services/enable": {
      "post": {
        "operationId": "ControlPlaneAPI_EnableServices",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/velez_apiEnableServicesResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/googlerpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/velez_apiEnableServicesRequest"
            }
          }
        ],
        "tags": [
          "ControlPlaneAPI"
        ]
      }
    },
    "/api/slave/connect": {
      "post": {
        "summary": "ConnectSlave - used by other Velez nodes to connect to cluster",
        "operationId": "ControlPlaneAPI_ConnectSlave",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/velez_apiConnectSlaveResponse"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/googlerpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/velez_apiConnectSlaveRequest"
            }
          }
        ],
        "tags": [
          "ControlPlaneAPI"
        ]
      }
    }
  },
  "definitions": {
    "ContainerHardware": {
      "type": "object",
      "properties": {
        "cpuAmount": {
          "type": "number",
          "format": "float"
        },
        "ramMb": {
          "type": "integer",
          "format": "int64"
        },
        "memorySwapMb": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "ContainerHealthcheck": {
      "type": "object",
      "properties": {
        "command": {
          "type": "string",
          "title": "if command is not presented,\nvelez will simply\nwait \"retires\" times for \"interval_second\" seconds each time,\nuntil container get status Running"
        },
        "intervalSecond": {
          "type": "integer",
          "format": "int64"
        },
        "timeoutSecond": {
          "type": "integer",
          "format": "int64"
        },
        "retries": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "ContainerSettings": {
      "type": "object",
      "properties": {
        "ports": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/velez_apiPort"
          }
        },
        "network": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/velez_apiNetworkBind"
          }
        },
        "volumes": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/velez_apiVolume"
          }
        }
      }
    },
    "PortProtocol": {
      "type": "string",
      "enum": [
        "unknown",
        "tcp",
        "udp"
      ],
      "default": "unknown"
    },
    "googlerpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "@type": {
          "type": "string"
        }
      },
      "additionalProperties": {}
    },
    "velez_apiConfigFormat": {
      "type": "string",
      "enum": [
        "yaml",
        "env"
      ],
      "default": "yaml",
      "title": "- yaml: Default"
    },
    "velez_apiConnectSlaveRequest": {
      "type": "object"
    },
    "velez_apiConnectSlaveResponse": {
      "type": "object"
    },
    "velez_apiCreateSmerdRequest": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "imageName": {
          "type": "string"
        },
        "hardware": {
          "$ref": "#/definitions/ContainerHardware"
        },
        "settings": {
          "$ref": "#/definitions/ContainerSettings"
        },
        "command": {
          "type": "string"
        },
        "env": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "healthcheck": {
          "$ref": "#/definitions/ContainerHealthcheck"
        },
        "labels": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "ignoreConfig": {
          "type": "boolean"
        },
        "useImagePorts": {
          "type": "boolean"
        },
        "autoUpgrade": {
          "type": "boolean"
        },
        "restart": {
          "$ref": "#/definitions/velez_apiRestartPolicy"
        },
        "config": {
          "$ref": "#/definitions/velez_apiMatreshkaConfigSpec"
        }
      }
    },
    "velez_apiEnableServicesRequest": {
      "type": "object",
      "properties": {
        "services": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/velez_apiVervServiceType"
          }
        }
      }
    },
    "velez_apiEnableServicesResponse": {
      "type": "object"
    },
    "velez_apiListServicesResponse": {
      "type": "object",
      "properties": {
        "services": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/velez_apiService"
          }
        },
        "inactiveServices": {
          "type": "array",
          "items": {
            "type": "object",
            "$ref": "#/definitions/velez_apiService"
          }
        }
      }
    },
    "velez_apiMatreshkaConfigSpec": {
      "type": "object",
      "properties": {
        "configName": {
          "type": "string",
          "title": "Name of config. By default velez will try to guess config by\nindirect signs such as (no priority)\n - special MATRESHKA_CONFIG tags\n - image (e.g. postgres, angie and etc)\n - smerd's name (starting with special prefix)"
        },
        "configVersion": {
          "type": "string",
          "title": "Version to load into smerd. By default - master"
        },
        "configFormat": {
          "$ref": "#/definitions/velez_apiConfigFormat",
          "title": "Format of config. Different default for different types\ne.g\n   - verv - sets config as environment variables\n   - pg - writes to a config file\ngeneral rule - if target_path is not set -\u003e it's a environment variables"
        },
        "systemPath": {
          "type": "string",
          "description": "If not set - writes config as an environment variables",
          "title": "target path of config.\n   If set and has .yaml extension - writes yaml file at path"
        }
      }
    },
    "velez_apiNetworkBind": {
      "type": "object",
      "properties": {
        "networkName": {
          "type": "string"
        },
        "aliases": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "velez_apiPort": {
      "type": "object",
      "properties": {
        "servicePortNumber": {
          "type": "integer",
          "format": "int64"
        },
        "protocol": {
          "$ref": "#/definitions/PortProtocol"
        },
        "exposedTo": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "velez_apiRestartPolicy": {
      "type": "object",
      "properties": {
        "type": {
          "$ref": "#/definitions/velez_apiRestartPolicyType"
        },
        "FailureCount": {
          "type": "integer",
          "format": "int64"
        }
      }
    },
    "velez_apiRestartPolicyType": {
      "type": "string",
      "enum": [
        "unless_stopped",
        "no",
        "always",
        "on_failure"
      ],
      "default": "unless_stopped"
    },
    "velez_apiService": {
      "type": "object",
      "properties": {
        "type": {
          "$ref": "#/definitions/velez_apiVervServiceType"
        },
        "port": {
          "type": "integer",
          "format": "int64"
        },
        "constructor": {
          "$ref": "#/definitions/velez_apiCreateSmerdRequest"
        },
        "togglable": {
          "type": "boolean"
        }
      }
    },
    "velez_apiVervServiceType": {
      "type": "string",
      "enum": [
        "unknown_service_type",
        "matreshka",
        "makosh",
        "webserver",
        "headscale",
        "portainer"
      ],
      "default": "unknown_service_type"
    },
    "velez_apiVolume": {
      "type": "object",
      "properties": {
        "volumeName": {
          "type": "string"
        },
        "containerPath": {
          "type": "string"
        }
      }
    }
  }
}
